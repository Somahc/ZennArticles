---
title: "NextAuth å‹.Adapterã‚’å‹.Adapterã«å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã‚¨ãƒ©ãƒ¼"
emoji: "ğŸ”Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Nextjs", "React", "TypeScript", "NextAuth"]
published: true
---

## ç—‡çŠ¶
Next.js14(App Router)ã¨NextAuthã‚’ä½¿ã£ã¦Googleã¨GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’åˆ©ç”¨ã—ãŸOAuthã‚’å®Ÿè£…ã—ãŸã®ã¡ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã‚’DBã‚’ä½¿ã£ã¦ç®¡ç†ã—ãŸã„ã¨æ€ã„ã¾ã—ãŸã€‚
ä»¥ä¸‹ã®Auth.jsã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆè‡ªåˆ†ã®å ´åˆã¯`api/auth/[...nextauth]`é…ä¸‹ã®`route.ts`ï¼‰ã«å¯¾ã—ã¦Adapterã®æƒ…å ±ã‚’è¿½åŠ ã—ãŸã¨ã“ã‚ã€Adapterã«èµ¤æ³¢ç·šã‚’å¼•ã‹ã‚Œã¦ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã—ã¾ã„ã¾ã—ãŸã€‚

```ts:route.ts
import NextAuth from 'next-auth';
import GithubProvider from "next-auth/providers/github"
import GoogleProvider from "next-auth/providers/google"

const handler = NextAuth({
    providers: [
        GithubProvider({
            clientId: process.env.GITHUB_ID as string,
            clientSecret:a process.env.GITHUB_SECRET as string,
        }),
        GoogleProvider({
            clientId: process.env.GOOGLE_ID as string,
            clientSecret: process.env.GOOGLE_SECRET as string,
        }),
    ],
});

export { handler as GET, handler as POST }
```

```ts:route.ts(å¤‰æ›´å¾Œ)
import NextAuth from 'next-auth';
import GithubProvider from "next-auth/providers/github"
import GoogleProvider from "next-auth/providers/google"
// è¿½åŠ 
import { PrismaAdapter } from "@auth/prisma-adapter";
import prisma from "../../../lib/prisma";

const handler = NextAuth({
    adapter: PrismaAdapter(prisma), // è¿½åŠ (ã“ã“ã§ã‚¨ãƒ©ãƒ¼)
    providers: [
        GithubProvider({
            clientId: process.env.GITHUB_ID as string,
            clientSecret:a process.env.GITHUB_SECRET as string,
        }),
        GoogleProvider({
            clientId: process.env.GOOGLE_ID as string,
            clientSecret: process.env.GOOGLE_SECRET as string,
        }),
    ],
    // sessionã®è¨­å®šã‚‚è¿½åŠ 
    session: {
        strategy: "database",
        maxAge: 60 * 60 * 24 * 30, // 30 days
        updateAge: 60 * 60 * 24, // 24 hours
    },
});

export { handler as GET, handler as POST }
```

ã‚¨ãƒ©ãƒ¼ã®å†…å®¹ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚
```bash:ã‚¨ãƒ©ãƒ¼
å‹ 'import("/<ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª>/node_modules/@auth/core/adapters").Adapter' ã‚’å‹ 'import("/<ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª>/node_modules/next-auth/adapters").Adapter' ã«å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
```

## è§£æ±º
ã‚¨ãƒ©ãƒ¼ã®å†…å®¹ã§ã‚°ã‚°ã£ãŸã¨ã“ã‚ä»¥ä¸‹ã®GitHubã®ã‚¹ãƒ¬ãƒƒãƒ‰ã«è¡Œãå½“ãŸã‚Šã€ã“ã‚“ãªã‚³ãƒ¡ãƒ³ãƒˆã‚’ç™ºè¦‹ã€‚
```ts
import type { Adapter } from 'next-auth/adapters';
...
adapter: TypeORMAdapter(connection) as Adapter,
```

ã“ã¡ã‚‰ã‚’è¿½è¨˜ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ãŸã¨ã“ã‚ã‚¨ãƒ©ãƒ¼ãŒè§£æ¶ˆã•ã‚Œã¾ã—ãŸã€‚
```ts:route.ts(ä¿®æ­£å¾Œ)
import NextAuth from 'next-auth';
import GithubProvider from "next-auth/providers/github"
import GoogleProvider from "next-auth/providers/google"
import { PrismaAdapter } from "@auth/prisma-adapter";
import prisma from "../../../lib/prisma";
import type { Adapter } from 'next-auth/adapters'; // è¿½åŠ 

const handler = NextAuth({
    adapter: PrismaAdapter(prisma) as Adapter, // è¿½åŠ 
    providers: [
        GithubProvider({
            clientId: process.env.GITHUB_ID as string,
            clientSecret:process.env.GITHUB_SECRET as string,
        }),
        GoogleProvider({
            clientId: process.env.GOOGLE_ID as string,
            clientSecret: process.env.GOOGLE_SECRET as string,
        }),
    ],
    session: {
        strategy: "database",
        maxAge: 60 * 60 * 24 * 30, // 30 days
        updateAge: 60 * 60 * 24, // 24 hours
    },
});

export { handler as GET, handler as POST }
```

## åŸå› ï¼Ÿ
`as ~`ã¯å‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã¨ã„ã†æ–‡æ³•ã§ã€TypeScriptãŒæ¨è«–ã—ãŸæ–¹ã‚’ä»»æ„ã®å‹ã§ä¸Šæ›¸ãã§ãã‚‹æ©Ÿèƒ½ã®ã‚ˆã†ã§ã™ã€‚ä¿®æ­£å‰ã ã¨NextAuthãŒAdapterã«å¯¾ã—ã¦æœŸå¾…ã—ã¦ã„ã‚‹å‹ã¨`PrismaAdapter(prisma)`ã‹ã‚‰æ¨è«–ã•ã‚Œã‚‹å‹ã®æƒ…å ±ãŒåˆã‚ãªã„ã“ã¨ã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼ã ã£ãŸã®ã§ã—ã‚‡ã†ã‹ã€ã€ï¼Ÿ

TSã‚‚èªè¨¼ã‚‚åˆå¿ƒè€…ãªã®ã§ã—ã£ã‹ã‚Šã¨ã¯ã‚ã‹ã£ã¦ã„ã¾ã›ã‚“ãŒã€å‹ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã§Adapterå‹ã§ã‚ã‚‹ã“ã¨ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ç„¡äº‹è§£æ±ºã§ãã¾ã—ãŸã€‚

## å‚è€ƒ
https://github.com/nextauthjs/next-auth/issues/6106#issuecomment-1582582312
https://typescript-jp.gitbook.io/deep-dive/type-system/type-assertion